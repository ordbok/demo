/* Copyright (c) ORDBOK contributors. All rights reserved.                   */

define("@ordbok/core/ajax",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){this._cache={},this.baseUrl=e||"",this.cacheTimeout=t||36e5,this.responseTimeout=n||6e4}return e.prototype.request=function(e){var t=this;return new Promise(function(n,r){var i=t.baseUrl+e;if(t.cacheTimeout>0){var o=t._cache[i],u=(new Date).getTime()+t.cacheTimeout;if(o&&o.timestamp>u)return void n(o);delete t._cache[i]}var s=new XMLHttpRequest;try{0===t.cacheTimeout&&-1===i.indexOf("?")?s.open("GET",i+"?"+(new Date).getTime(),!0):s.open("GET",i,!0),s.timeout=t.responseTimeout,s.addEventListener("load",function(e){return n({result:(s.response||"").toString(),serverStatus:s.status,timestamp:e.timeStamp,url:i})}),s.addEventListener("error",function(e){var t=new Error("error");t.result=s.response.toString(),t.serverStatus=s.status,t.timestamp=e.timeStamp,t.url=i,r(t)}),s.addEventListener("timeout",function(e){var t=new Error("timeout");t.result=s.response.toString(),t.serverStatus=s.status,t.timestamp=e.timeStamp,t.url=i,r(t)}),s.send()}catch(e){var a=e;a.result=s.response||"",a.timestamp=(new Date).getTime(),a.serverStatus=s.status,a.url=i,r(a)}})},e}();t.Ajax=n}),define("@ordbok/core/utilities",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=/[^0-9A-Za-z\u0080-\uFFFF -]/g,r=/^(.*?)([^\.\/]*)([^\/]*)$/,i=/\s+/g;!function(e){function t(e){var t=r.exec(e);return t&&t[3]||""}function o(e){var t=r.exec(e);return t&&t[2]||""}function u(e){return e.replace(n," ").trim().replace(i,"-").toLowerCase()}function s(e){return e.replace(n," ").trim().replace(i," ").toLowerCase()}function a(e){var t=r.exec(e);return t&&t[1]||""}function c(e){for(var t=[],n=0,r=0,i=e.length;r<i;++r)n=e.charCodeAt(r),n>31&&n<128&&(n+=n<80?48:-48),t.push(String.fromCharCode(n));return t.join("")}e.getExtension=t,e.getBaseName=o,e.getKey=u,e.getNorm=s,e.getParentPath=a,e.rotate=c}(t.Utilities||(t.Utilities={}))});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("@ordbok/core/dictionary",["require","exports","./ajax","./utilities"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.parse=function(e){var t,n,r={};return e.split("\n").forEach(function(e){if(-1===e.indexOf(":"))return void(r[e]=n={});n&&(t=e.split(":",2),n[t[0]]=t[1].split(";"))}),r},t.stringify=function(e){var t,n=[];return Object.keys(e).forEach(function(i){n.push(r.Utilities.getKey(i)),t=e[i],Object.keys(t).forEach(function(e){return n.push(r.Utilities.getKey(e)+":"+t[e].join(";"))})}),n.join("\n")},t.prototype.loadEntry=function(e,n){var i=this;return void 0===n&&(n=0),new Promise(function(o){i.request(r.Utilities.getKey(e)+"-"+n+t.FILE_EXTENSION).then(function(e){if(!(e instanceof Error||e.serverStatus>=400))return t.parse(e.result)}).catch(function(e){console.error(e)}).then(o)})},t.FILE_EXTENSION=".txt",t}(n.Ajax);t.Dictionary=i}),define("@ordbok/core/text",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=/\s+/g,r=function(){function e(e){this._value=e}return e.endsWith=function(e,t){if(e===t)return!0;var n=e.length,r=t.length;return r<=n&&e.lastIndexOf(t)===n-r},e.trimSpaces=function(e){return e.replace(n," ").trim()},e.prototype.endsWith=function(t){return e.endsWith(this._value,t)},e.prototype.trimSpaces=function(){return new e(e.trimSpaces(this._value))},e}();t.Text=r}),define("@ordbok/core/markdown",["require","exports","./text"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=/^(?:#+([\s\S]*)|([\s\S]*?)\n(?:={3,}|-{3,}))$/,i=/^([^\:\n\r\t\v]+):([\s\S]*)$/,o=/(?:^\n?|\n\n)-{3,}(?:\n\n|\n?$)/,u=/\n{2,}/,s=function(){function e(e){this._pages=[],this._raw=e,this.parse(e)}return e.parsePage=function(e){var t,o,s={};return e.split(u).forEach(function(e){t=r.exec(e),t&&(s[n.Text.trimSpaces(t[1]||t[2])]=o={}),o&&(t=i.exec(e))&&(o[t[1]]=t[2].split(";").map(n.Text.trimSpaces))}),s},Object.defineProperty(e.prototype,"pages",{get:function(){return this._pages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"raw",{get:function(){return this._raw},enumerable:!0,configurable:!0}),e.prototype.parse=function(t){var n=this._pages;t.split(o).forEach(function(t){return n.push(e.parsePage(t))})},e}();t.Markdown=s}),define("@ordbok/core/index",["require","exports","./ajax","./dictionary","./markdown","./text","./utilities"],function(e,t,n,r,i,o,u){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n),s(r),s(i),s(o),s(u)}),define("@ordbok/core",["@ordbok/core/index"],function(e){return e});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("@ordbok/index-plugin/index",["require","exports","@ordbok/core"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(n,r,i){return e.call(this,(n||"")+t.SUBFOLDER,r,i)||this}return __extends(t,e),t.parse=function(e){var t,n={};return e.split("\n").forEach(function(e){-1!==e.indexOf("\t")&&(t=e.split("\t"),t.length<2||(n[t[0]]=parseInt(t[1])))}),n},t.stringify=function(e){return Object.keys(e).map(function(t){return n.Utilities.getKey(t)+"\t"+e[t]}).join("\n")},t.stringifyHeadlines=function(e){return e.join("\n")},t.prototype.loadHeadlines=function(){return this.request("index"+t.FILE_EXTENSION).then(function(e){if(e instanceof Error||e.serverStatus>=400)throw new Error("HTTP "+e.serverStatus);return e.result.split("\n")})},t.prototype.loadFileIndex=function(e){return this.request(n.Utilities.getKey(e)+t.FILE_EXTENSION).then(function(e){return e instanceof Error||e.serverStatus>=400?{}:t.parse(e.result)}).catch(function(e){return console.error(e),{}})},t.FILE_EXTENSION=".txt",t.SUBFOLDER="index/",t}(n.Ajax);t.Index=r}),define("@ordbok/index-plugin",["@ordbok/index-plugin/index"],function(e){return e}),define("demo/index",["require","exports","@ordbok/core","@ordbok/index-plugin"],function(e,t,n,r){"use strict";function i(){var e=n.Utilities.getKey(c.value);f?f.innerHTML="":(f=document.createElement("TABLE"),f.setAttribute("border","1"),document.body.appendChild(f)),d.loadFileIndex("English").then(function(t){var n=t[e];if(void 0!==n)for(var r=0,i=n;r<=i;++r)p.loadEntry(e,r).then(o).catch(alert)})}function o(e){e&&(u(e),Object.keys(e).filter(function(e){return e!==h}).forEach(function(t){return s(t,e[t].translation)}))}function u(e){var t=document.createElement("TR");f.appendChild(t);var n=document.createElement("TH");t.appendChild(n),n.innerText="Language",(e[h]&&e[h].structure||[""]).forEach(function(e){n=document.createElement("TH"),t.appendChild(n),n.innerText=e})}function s(e,t){var n,r=document.createElement("TH"),i=document.createElement("TR");f.appendChild(i),i.appendChild(r),r.innerText=l[e]||e,t.forEach(function(e){n=document.createElement("TD"),i.appendChild(n),n.innerText=e})}function a(){p=new n.Dictionary("translations/"),d=new r.Index("translations/"),l={},c=document.getElementById("search"),c.addEventListener("change",i),d.loadHeadlines().then(function(e){e.filter(function(e){return e!==h}).forEach(function(e){l[n.Utilities.getKey(e)]=e})})}Object.defineProperty(t,"__esModule",{value:!0});var c,f,p,d,l,h=n.Utilities.getKey("Meta");t.start=a}),define("demo",["require","exports","demo/index"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n)});