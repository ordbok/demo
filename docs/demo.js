/* Copyright (c) ORDBOK contributors. All rights reserved.                   */

define("@ordbok/core/ajax",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=36e5),void 0===n&&(n=6e4),this._cache={},this._requests=0,this.baseUrl=e,this.cacheTimeout=t<0?0:t,this.responseTimeout=n<0?0:n}return e.prototype.onError=function(e){var t=this.context;if(t){var n=new Error("error");n.result=this.response.toString(),n.serverStatus=this.status,n.timestamp=e.timeStamp,n.url=t.url,t.isCountingRequest&&(t.isCountingRequest=!1,t.ajax._requests--),t.reject(n)}},e.prototype.onLoad=function(e){var t=this.context;t&&(t.isCountingRequest&&(t.isCountingRequest=!1,t.ajax._requests--),t.resolve({result:(this.response||"").toString(),serverStatus:this.status,timestamp:e.timeStamp,url:t.url}))},e.prototype.onTimeout=function(e){var t=this.context;if(t){var n=new Error("timeout");n.result=this.response.toString(),n.serverStatus=this.status,n.timestamp=e.timeStamp,n.url=t.url,t.isCountingRequest&&(t.isCountingRequest=!1,t.ajax._requests--),t.reject(n)}},e.prototype.hasOpenRequest=function(){return this._requests<0&&(this._requests=0),this._requests>0},e.prototype.request=function(e){var t=this;return new Promise(function(n,r){var i=t.baseUrl+e,o={ajax:t,resolve:n,reject:r,url:i};if(t.cacheTimeout>0){var u=t._cache[i],s=(new Date).getTime()+t.cacheTimeout;if(u&&u.timestamp>s)return void n(u);delete t._cache[i]}var c=new XMLHttpRequest;c.context=o,o.isCountingRequest=!1;try{t.cacheTimeout<=0&&-1===i.indexOf("?")?c.open("GET",i+"?"+(new Date).getTime(),!0):c.open("GET",i,!0),t._requests++,o.isCountingRequest=!0,c.timeout=t.responseTimeout,c.addEventListener("load",t.onLoad),c.addEventListener("error",t.onError),c.addEventListener("timeout",t.onTimeout),c.send()}catch(e){var a=e;a.result=c.response||"",a.timestamp=(new Date).getTime(),a.serverStatus=c.status,a.url=o.url,o.isCountingRequest&&(o.isCountingRequest=!1,o.ajax._requests--),r(a)}})},e}();t.Ajax=n}),define("@ordbok/core/utilities",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=/[^0-9A-Za-z\u0080-\uFFFF -]/g,r=/^(.*?)([^\.\/]*)([^\/]*)$/,i=/\s+/g;!function(e){function t(e){var t=r.exec(e);return t&&t[3]||""}function o(e){var t=r.exec(e);return t&&t[2]||""}function u(e){return e.replace(n," ").trim().replace(i,"-").toLowerCase()}function s(e){return e.replace(n," ").trim().replace(i," ").toLowerCase()}function c(e){var t=r.exec(e);return t&&t[1]||""}function a(e){for(var t=[],n=0,r=0,i=e.length;r<i;++r)n=e.charCodeAt(r),n>31&&n<128&&(n+=n<80?48:-48),t.push(String.fromCharCode(n));return t.join("")}e.getExtension=t,e.getBaseName=o,e.getKey=u,e.getNorm=s,e.getParentPath=c,e.rotate=a}(t.Utilities||(t.Utilities={}))});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("@ordbok/core/dictionary",["require","exports","./ajax","./utilities"],function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.parse=function(e){var n,r,i={};return e.split(t.LINE_SEPARATOR).forEach(function(e){if(-1===e.indexOf(t.PAIR_SEPARATOR))return void(i[e]=r={});r&&(n=e.split(t.PAIR_SEPARATOR,2),r[n[0]]=n[1].split(t.VALUE_SEPARATOR))}),i},t.stringify=function(e){var n,i=[];return Object.keys(e).forEach(function(o){i.push(r.Utilities.getKey(o)),n=e[o],Object.keys(n).forEach(function(e){return i.push(r.Utilities.getKey(e)+t.PAIR_SEPARATOR+n[e].join(t.VALUE_SEPARATOR))})}),i.join(t.LINE_SEPARATOR)},t.prototype.loadEntry=function(e,n){return void 0===n&&(n=0),this.request(r.Utilities.getKey(e)+t.FILE_SEPARATOR+n+t.FILE_EXTENSION).then(function(e){if(!(e instanceof Error||e.serverStatus>=400))return t.parse(e.result)}).catch(function(e){console.error(e)})},t.FILE_EXTENSION=".txt",t.FILE_SEPARATOR="-",t.LINE_SEPARATOR="\n",t.PAIR_SEPARATOR=":",t.VALUE_SEPARATOR=";",t}(n.Ajax);t.Dictionary=i});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("@ordbok/core/text",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=/\([^\)]*\)|\[[^\]]*\]|\{[^\}]*\}/g,r=/\s+/g,i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.endsWith=function(e,t){if(e===t)return!0;var n=e.length,r=t.length;return r<=n&&e.lastIndexOf(t)===n-r},t.removeBrackets=function(e){return e.replace(n,"").replace(r," ").trim()},t.trimSpaces=function(e){return e.replace(r," ").trim()},t.prototype.endsWith=function(e){return t.endsWith(this.toString(),e)},t.prototype.removeBrackets=function(){return new t(t.removeBrackets(this.toString()))},t.prototype.trimSpaces=function(){return new t(t.trimSpaces(this.toString()))},t}(String);t.Text=i}),define("@ordbok/core/markdown",["require","exports","./text"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=/^(?:#+([\s\S]*)|([\s\S]*?)\n(?:={3,}|-{3,}))$/,i=/^([^\:\n\r\t\v]+):([\s\S]*)$/,o=/(?:^\n?|\n\n)-{3,}(?:\n\n|\n?$)/,u=/\n{2,}/,s=function(){function e(e){this._pages=[],this._raw=e,this.parse(e)}return e.parsePage=function(e){var t,o,s={};return e.split(u).forEach(function(e){t=r.exec(e),t&&(s[n.Text.trimSpaces(t[1]||t[2])]=o={}),o&&(t=i.exec(e))&&(o[t[1]]=t[2].split(";").map(n.Text.trimSpaces))}),s},Object.defineProperty(e.prototype,"pages",{get:function(){return this._pages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"raw",{get:function(){return this._raw},enumerable:!0,configurable:!0}),e.prototype.parse=function(t){var n=this._pages;t.split(o).forEach(function(t){return n.push(e.parsePage(t))})},e}();t.Markdown=s}),define("@ordbok/core/index",["require","exports","./ajax","./dictionary","./markdown","./text","./utilities"],function(e,t,n,r,i,o,u){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n),s(r),s(i),s(o),s(u)}),define("@ordbok/core",["@ordbok/core/index"],function(e){return e});var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();define("@ordbok/index-plugin/index",["require","exports","@ordbok/core"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(n,r,i){return void 0===n&&(n=""),e.call(this,n+t.SUBFOLDER,r,i)||this}return __extends(t,e),t.parse=function(e){var t,r={};return e.split(n.Dictionary.LINE_SEPARATOR).forEach(function(e){-1!==e.indexOf(n.Dictionary.PAIR_SEPARATOR)&&(t=e.split(n.Dictionary.PAIR_SEPARATOR),t.length<2||(r[t[0]]=parseInt(t[1])))}),r},t.stringify=function(e){return Object.keys(e).map(function(t){return n.Utilities.getKey(t)+n.Dictionary.PAIR_SEPARATOR+e[t]}).join(n.Dictionary.LINE_SEPARATOR)},t.stringifyHeadlines=function(e){return e.join(n.Dictionary.LINE_SEPARATOR)},t.prototype.loadHeadlines=function(){return this.request("index"+n.Dictionary.FILE_EXTENSION).then(function(e){if(e instanceof Error||e.serverStatus>=400)throw new Error("HTTP "+e.serverStatus);return e.result.split(n.Dictionary.LINE_SEPARATOR)})},t.prototype.loadFileIndex=function(e){return this.request(n.Utilities.getKey(e)+n.Dictionary.FILE_EXTENSION).then(function(e){return e instanceof Error||e.serverStatus>=400?{}:t.parse(e.result)}).catch(function(e){return console.error(e),{}})},t.SUBFOLDER="index/",t}(n.Ajax);t.Index=r}),define("@ordbok/index-plugin",["@ordbok/index-plugin/index"],function(e){return e}),define("demo/config",["require","exports","@ordbok/core"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TRANSLATION_SUBFOLDER="translations/",t.META_KEY=n.Utilities.getKey("Meta")}),define("demo/results",["require","exports","demo/config","@ordbok/core","@ordbok/index-plugin"],function(e,t,n,r,i){"use strict";function o(){p.innerHTML=""}function u(){s(),c()}function s(){var e=document.getElementById("results");if(!e)throw new Error("Results container not found!");p=e}function c(){h={},l=new i.Index(n.TRANSLATION_SUBFOLDER),l.loadHeadlines().then(function(e){e.filter(function(e){return e!==n.META_KEY}).forEach(function(e){h[r.Utilities.getKey(e)]=e})}).catch(function(e){console.error(e)})}function a(e){if(e){var t=document.createElement("TABLE");p.appendChild(t),f(t,e),Object.keys(e).filter(function(e){return e!==n.META_KEY}).forEach(function(n){d(t,e,n)})}}function f(e,t){var r=document.createElement("TR");e.appendChild(r);var i=document.createElement("TH");r.appendChild(i),i.innerText="Language",(t[n.META_KEY]&&t[n.META_KEY].structure||[""]).forEach(function(e){i=document.createElement("TH"),r.appendChild(i),i.innerText=e})}function d(e,t,r){var i=[].concat(t[n.META_KEY]&&t[n.META_KEY].grammar,t[r].grammar).filter(function(e){return!!e}),o=t[r].translation,u=document.createElement("TR");e.appendChild(u);var s=document.createElement("TH");u.appendChild(s),i.length>0&&u.setAttribute("title",i.join(", ")),s.innerText=h[r]||r;var c;o.forEach(function(e){c=document.createElement("TD"),u.appendChild(c),c.innerText=e})}Object.defineProperty(t,"__esModule",{value:!0});var p,l,h;t.clear=o,t.init=u,t.show=a}),define("demo/search",["require","exports","demo/config","demo/results","@ordbok/core","@ordbok/index-plugin"],function(e,t,n,r,i,o){"use strict";function u(e){var t=e.target;t instanceof HTMLButtonElement&&t.previousSibling instanceof HTMLInputElement&&_(t.previousSibling.value)}function s(e){var t=e.target;t instanceof HTMLInputElement&&(t.value||r.clear())}function c(e){var t=e.target;t instanceof HTMLInputElement&&_(t.value)}function a(){h(),l(),f()}function f(){var e=document.getElementById("search");if(!e)throw new Error("Search container not found!");m=e,d(),p()}function d(){var e=m.getElementsByTagName("button")[0];if(!e)throw new Error("Search button not found!");e.addEventListener("click",u)}function p(){var e=m.getElementsByTagName("input")[0];if(!e)throw new Error("Search input not found!");e.addEventListener("change",s),e.addEventListener("click",s),e.addEventListener("keyup",c),e.focus()}function l(){g=new o.Index(n.TRANSLATION_SUBFOLDER)}function h(){T=new i.Dictionary(n.TRANSLATION_SUBFOLDER)}function _(e){y&&window.clearTimeout(y),y=window.setTimeout(E,500,e)}function E(e){var t=i.Utilities.getKey(e);T.hasOpenRequest()||(r.clear(),g.loadFileIndex("English").then(function(n){var r=n[t];void 0!==r&&v(e,r)}))}function v(e,t){for(var n=i.Utilities.getKey(e),o=0;o<=t;++o)T.loadEntry(n,o).then(r.show).catch(alert)}Object.defineProperty(t,"__esModule",{value:!0});var m,y,g,T;t.init=a}),define("demo/index",["require","exports","demo/results","demo/search"],function(e,t,n,r){"use strict";function i(){try{n.init(),r.init()}catch(e){alert(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.start=i}),define("demo",["require","exports","demo/index"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n)});